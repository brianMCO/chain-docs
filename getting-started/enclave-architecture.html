<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Enclave Architecture | Crypto.com Chain</title>
    <meta name="description" content="Welcome to Crypto.com Chain&#39;s documentation!">
    
    
    <link rel="preload" href="/chain-docs/assets/css/0.styles.f91b77af.css" as="style"><link rel="preload" href="/chain-docs/assets/js/app.2d891d29.js" as="script"><link rel="preload" href="/chain-docs/assets/js/2.faa21682.js" as="script"><link rel="preload" href="/chain-docs/assets/js/10.73efb3c0.js" as="script"><link rel="prefetch" href="/chain-docs/assets/js/11.6b21363d.js"><link rel="prefetch" href="/chain-docs/assets/js/12.5585ffd4.js"><link rel="prefetch" href="/chain-docs/assets/js/13.6aba041b.js"><link rel="prefetch" href="/chain-docs/assets/js/14.9c5b06b2.js"><link rel="prefetch" href="/chain-docs/assets/js/15.bfb345d6.js"><link rel="prefetch" href="/chain-docs/assets/js/16.2d6c9435.js"><link rel="prefetch" href="/chain-docs/assets/js/17.305ce18d.js"><link rel="prefetch" href="/chain-docs/assets/js/18.1f273f5f.js"><link rel="prefetch" href="/chain-docs/assets/js/19.2d739ed4.js"><link rel="prefetch" href="/chain-docs/assets/js/20.834fbdab.js"><link rel="prefetch" href="/chain-docs/assets/js/3.dd5706d6.js"><link rel="prefetch" href="/chain-docs/assets/js/4.81da6feb.js"><link rel="prefetch" href="/chain-docs/assets/js/5.509d06a8.js"><link rel="prefetch" href="/chain-docs/assets/js/6.4fbfe872.js"><link rel="prefetch" href="/chain-docs/assets/js/7.88433caf.js"><link rel="prefetch" href="/chain-docs/assets/js/8.e854ffd3.js"><link rel="prefetch" href="/chain-docs/assets/js/9.304b82fe.js">
    <link rel="stylesheet" href="/chain-docs/assets/css/0.styles.f91b77af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/chain-docs/" class="home-link router-link-active"><!----> <span class="site-name">Crypto.com Chain</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/chain-docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/chain-docs/getting-started/" class="nav-link router-link-active">Getting Started</a></div><div class="nav-item"><a href="https://github.com/crypto-com/chain/tree/master/client-rpc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Client RPC
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://crypto-com.github.io/Crypto.com_Chain.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/chain-docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/chain-docs/getting-started/" class="nav-link router-link-active">Getting Started</a></div><div class="nav-item"><a href="https://github.com/crypto-com/chain/tree/master/client-rpc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Client RPC
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://crypto-com.github.io/Crypto.com_Chain.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/chain-docs/getting-started/" class="sidebar-link">Getting Started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#pre-requisites" class="sidebar-link">Pre-requisites</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#how-it-works" class="sidebar-link">How it works</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#compile-enclave" class="sidebar-link">Compile enclave</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#setup-path" class="sidebar-link">Setup path</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#install-rust" class="sidebar-link">Install Rust</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#install-tendermint" class="sidebar-link">Install Tendermint</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#get-source-code" class="sidebar-link">Get source code</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#compile-chain-abci" class="sidebar-link">Compile chain-abci</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#run-the-program" class="sidebar-link">Run the program</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/#other-information" class="sidebar-link">Other information</a></li></ul></li><li><a href="/chain-docs/getting-started/consensus.html" class="sidebar-link">Consensus</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/consensus.html#client-interacting-with-the-blockchain" class="sidebar-link">Client: Interacting with the blockchain</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/consensus.html#app-hash" class="sidebar-link">APP HASH</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/consensus.html#conventions" class="sidebar-link">Conventions</a></li></ul></li><li><a href="/chain-docs/getting-started/genesis.html" class="sidebar-link">Genesis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/genesis.html#tendermint-extra-information" class="sidebar-link">Tendermint extra information</a></li></ul></li><li><a href="/chain-docs/getting-started/transaction-accounting-model.html" class="sidebar-link">Transaction Accounting Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction-accounting-model.html#motivation" class="sidebar-link">Motivation</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction-accounting-model.html#utxo-accounts-model" class="sidebar-link">UTXO+Accounts model</a></li></ul></li><li><a href="/chain-docs/getting-started/transaction.html" class="sidebar-link">Transaction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction.html#transaction-identifier" class="sidebar-link">Transaction Identifier</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction.html#witness" class="sidebar-link">Witness</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction.html#textual-address-representation" class="sidebar-link">Textual Address Representation</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction.html#transaction-fees" class="sidebar-link">Transaction Fees</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction.html#transaction-types" class="sidebar-link">Transaction Types</a></li></ul></li><li><a href="/chain-docs/getting-started/serialization.html" class="sidebar-link">Serialization</a></li><li><a href="/chain-docs/getting-started/signature-schemes.html" class="sidebar-link">Signature Schemes</a></li><li><a href="/chain-docs/getting-started/client-flow.html" class="sidebar-link">Client Flow</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/client-flow.html#block-level-filtering" class="sidebar-link">Block-level filtering</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/client-flow.html#client-knows-transaction" class="sidebar-link">Client knows transaction</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/client-flow.html#client-doesn’t-know-transaction-data" class="sidebar-link">Client doesn’t know transaction data</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/client-flow.html#payment-transaction-submission" class="sidebar-link">Payment transaction submission</a></li></ul></li><li><a href="/chain-docs/getting-started/enclave-architecture.html" class="active sidebar-link">Enclave Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/enclave-architecture.html#technology" class="sidebar-link">Technology</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/enclave-architecture.html#transaction-validation" class="sidebar-link">Transaction validation</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/enclave-architecture.html#transaction-data-bootstrapping" class="sidebar-link">Transaction data bootstrapping</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/enclave-architecture.html#transaction-querying" class="sidebar-link">Transaction querying</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/enclave-architecture.html#transaction-creation" class="sidebar-link">Transaction creation</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/enclave-architecture.html#enclave-breaches" class="sidebar-link">Enclave breaches</a></li></ul></li><li><a href="/chain-docs/getting-started/transaction-privacy.html" class="sidebar-link">Transaction Privacy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction-privacy.html#motivation" class="sidebar-link">Motivation</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction-privacy.html#payloads" class="sidebar-link">Payloads</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/transaction-privacy.html#periodic-key-generation" class="sidebar-link">Periodic key generation</a></li></ul></li><li><a href="/chain-docs/getting-started/staking.html" class="sidebar-link">Staking</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#account" class="sidebar-link">Account</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#council-node" class="sidebar-link">Council Node</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#service-node" class="sidebar-link">Service Node</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#transaction-fee" class="sidebar-link">Transaction Fee</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#rewards" class="sidebar-link">Rewards</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#slashing" class="sidebar-link">Slashing</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/staking.html#“global-state”-app-hash" class="sidebar-link">“Global state” / APP_HASH</a></li></ul></li><li><a href="/chain-docs/getting-started/notes-on-production-deployment.html" class="sidebar-link">Notes on Production Deployment</a></li><li><a href="/chain-docs/getting-started/notes-on-performance.html" class="sidebar-link">Notes on Performance</a></li><li><a href="/chain-docs/getting-started/threat-model.html" class="sidebar-link">Threat Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/threat-model.html#severity" class="sidebar-link">Severity</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/threat-model.html#exploitability" class="sidebar-link">Exploitability</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/threat-model.html#assets" class="sidebar-link">Assets</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/threat-model.html#scope" class="sidebar-link">Scope</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/threat-model.html#system-diagram" class="sidebar-link">System Diagram</a></li><li class="sidebar-sub-header"><a href="/chain-docs/getting-started/threat-model.html#result" class="sidebar-link">Result</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="enclave-architecture"><a href="#enclave-architecture" aria-hidden="true" class="header-anchor">#</a> Enclave Architecture</h1> <p>The primary initial use of Trusted Execution Environments (TEE) is for enforcing payment data confidentiality (see <a href="./transaction-privacy">transaction privacy</a>), while maintaining flexibility and auditability. Other use cases may be developed in the long term.</p> <h2 id="technology"><a href="#technology" aria-hidden="true" class="header-anchor">#</a> Technology</h2> <p>The initial version is based on Intel SGX, but in the long-term, it would be desirable to support other TEE technology stacks, such as Arm TrustZone or RISC-V Keystone.</p> <h2 id="transaction-validation"><a href="#transaction-validation" aria-hidden="true" class="header-anchor">#</a> Transaction validation</h2> <p>The validation of transactions that involve payment obfuscated transaction outputs (see <a href="./transaction">transaction types</a> and <a href="./transaction-accounting-model">accounting model</a>) need to happen inside enclaves.</p> <p>For the ease of development, the transaction validation happens in a separate process. The Chain ABCI application process then communicates with this process using a simple request-reply protocol over a 0MQ socket:</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------+ REQ +--------+
|Chain ABCI +-----+ TX val.|
|           | REP | enc.   |
+-----------+     +--------+
</code></pre></div><p>In production deployment, both of these processes should be on the same machine and hence use IPC as the underlying transport for the 0MQ messages. In development, other transport mechanisms (e.g. TCP) can be used and processes could be in different locations, for example:</p> <ul><li>Chain ABCI is on executed on the developer laptop (any operating system), and the transaction validation enclave runs inside a Docker container (using the software-simulation mode).</li> <li>Chain ABCI is on executed on the developer laptop (any operating system), and the transaction validation enclave runs on a remote Linux machine (using the hardware mode).</li></ul> <h3 id="data-sealing"><a href="#data-sealing" aria-hidden="true" class="header-anchor">#</a> Data sealing</h3> <p>As previous transaction data is needed for transaction validation, it needs to be persisted locally. The enclave uses the process of “data sealing” for this purposes. To make the data accessible for future upgrades and other enclaves, it should be sealed with MRSIGNER-derived keys.</p> <h2 id="transaction-data-bootstrapping"><a href="#transaction-data-bootstrapping" aria-hidden="true" class="header-anchor">#</a> Transaction data bootstrapping</h2> <p>As old payment data becomes inaccessible due to the periodic key rotation (see <a href="./transaction-privacy">transaction privacy</a>), newly joined nodes (or nodes that went offline for some time) would need a way to bootstrap the old transaction data by connecting to enclaves of remote nodes and requesting transaction data that the other nodes have locally sealed.</p> <h3 id="lite-client-inside-enclaves"><a href="#lite-client-inside-enclaves" aria-hidden="true" class="header-anchor">#</a> Lite client inside enclaves</h3> <p>Each enclave should internally run a lite client that would keep track of the validator set, so that it can safely store the latest “app hash” (see consensus).</p> <h3 id="mutual-attestation"><a href="#mutual-attestation" aria-hidden="true" class="header-anchor">#</a> Mutual attestation</h3> <p>The core of the bootstrapping process lies in establishing a secure channel between two enclaves – e.g. TLS, see <a href="https://arxiv.org/pdf/1801.05863.pdf" target="_blank" rel="noopener noreferrer">Integrating Remote Attestation with Transport Layer Security<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. During the connection establishment, both parties present attestation reports that they cross-verify. This will initially utilize the Intel Attestation Service (IAS) where each full node is expected to run an IAS proxy that contains the required credentials (Key and SPID) that can be obtained on <a href="https://api.portal.trustedservices.intel.com/EPID-attestation" target="_blank" rel="noopener noreferrer">Intel portal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>In the future, the support for Data Center Attestation Primitives (DCAP) will be developed, so that each full node operator can run its own attestation service (rather than relying on IAS).</p> <p>Beyond the mutual attestation, enclaves should perform additional checks against the stored app hash, e.g. if the staked state-associated with the node’s enclave is valid (or check the whitelist entry in the case of higher tier nodes).</p> <h2 id="transaction-querying"><a href="#transaction-querying" aria-hidden="true" class="header-anchor">#</a> Transaction querying</h2> <p>As mentioned in <a href="./client-flow">client flows</a>, clients may not know their transaction data and would need to submit blind queries requesting data of some payment transactions.</p> <p>For this purpose, there needs to be an enclave that can unseal the previously stored transaction data, verify the client query and return the matching transactions.</p> <p>This process would again require establishing a secure connection channel between the client and the enclave (if it is remote) as in the transaction data bootstrapping – the difference is that it may only be one-side attested, as the client may not have access to the enclave architecture.</p> <h2 id="transaction-creation"><a href="#transaction-creation" aria-hidden="true" class="header-anchor">#</a> Transaction creation</h2> <p>When the client wishes to broadcast a payment transaction, they first need to obfuscate its content which can only be done within enclaves (that have been up-to-date with the network).</p> <p>For this purpose, there needs to be an enclave that can access the current random symmetric key obtained from other enclaves (similarly to the transaction validation enclave that needs it for decryption), so that it can encrypt the payment transaction content.</p> <h2 id="enclave-breaches"><a href="#enclave-breaches" aria-hidden="true" class="header-anchor">#</a> Enclave breaches</h2> <p>If enclaves were breached, it would lead to reduced confidentiality – there would still be a level of confidentiality, as the multi-signature scheme in Chain records only limited information in the blockchain (see <a href="./signature-schemes">signature schemes</a>). It would only affect transactions that were obfuscated with the breached key, as the key would be periodically rotated (see <a href="./transaction-privacy">transaction privacy</a>).</p> <p>Note that the breach wouldn’t lead to the loss of ledger integrity, as that is preserved by the <a href="./consensus">consensus algorithm</a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/chain-docs/getting-started/client-flow.html" class="prev">
          Client Flow
        </a></span> <span class="next"><a href="/chain-docs/getting-started/transaction-privacy.html">
          Transaction Privacy
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/chain-docs/assets/js/app.2d891d29.js" defer></script><script src="/chain-docs/assets/js/2.faa21682.js" defer></script><script src="/chain-docs/assets/js/10.73efb3c0.js" defer></script>
  </body>
</html>
